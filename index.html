<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WPB Launcher</title>
    <style>
        body { 
            font-family: sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            background: #f4f7f9; 
            /* åˆæœŸçŠ¶æ…‹ã‚’ã€Œé€æ˜ã€ã«ã™ã‚‹ã®ã‚’ã‚„ã‚ã¾ã—ãŸã€‚ç¢ºå®Ÿã«è¡¨ç¤ºã•ã›ã¾ã™ã€‚ */
        }
        .card { 
            background: white; 
            padding: 2rem; 
            border-radius: 8px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            text-align: center; 
            max-width: 80%;
        }
        .path { 
            color: #888; 
            font-size: 0.8rem; 
            word-break: break-all; 
            margin-top: 15px; 
            padding: 10px;
            background: #eee;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="card">
        <h3>ğŸš€ èµ·å‹•ã—ã¦ã„ã¾ã™...</h3>
        <p>ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰<b>ã€Œé–‹ãã€</b>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
        <p style="font-size:0.8rem; color:#666;">ï¼ˆè‡ªå‹•ã§é–‰ã˜ãªã„å ´åˆã¯Ã—ã§é–‰ã˜ã¦ãã ã•ã„ï¼‰</p>
        <div id="pathDisplay" class="path">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <script>
        // DOMã®æç”»ãŒçµ‚ã‚ã£ã¦ã‹ã‚‰ç¢ºå®Ÿã«å®Ÿè¡Œã™ã‚‹
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const path = urlParams.get('path');
            
            if (path) {
                const decodedPath = decodeURIComponent(path);
                document.getElementById('pathDisplay').innerText = decodedPath;

                // ã€é‡è¦ã€‘ãƒ–ãƒ©ã‚¦ã‚¶ãŒç”»é¢ã‚’æç”»ã™ã‚‹æ™‚é–“ã‚’å°‘ã—ã ã‘ä¸ãˆã‚‹ (100ms)
                setTimeout(() => {
                    // ãƒ—ãƒ­ãƒˆã‚³ãƒ«å‘¼ã³å‡ºã—
                    window.location.href = "wpb:" + decodedPath;
                    
                    // --- ã‚¯ãƒ­ãƒ¼ã‚ºå‡¦ç†ã®å¤šé‡åŒ– ---

                    // 1. ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒæˆ»ã£ã¦ããŸã‚‰é–‰ã˜ã‚‹ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ“ä½œå¾Œï¼‰
                    // â€»ä¸€åº¦ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚ŒãŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ©ã‚°
                    let hasLostFocus = false;
                    window.onblur = () => { hasLostFocus = true; };
                    window.onfocus = () => {
                        if (hasLostFocus) {
                            setTimeout(() => { window.close(); }, 500);
                        }
                    };

                    // 2. å¼·åˆ¶ã‚¿ã‚¤ãƒãƒ¼ (3ç§’å¾Œã«é–‰ã˜ã‚‹è©¦è¡Œã‚’ã™ã‚‹)
                    setTimeout(() => {
                        window.close();
                        // close()ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸå ´åˆã®ãŸã‚ã«ã€ç”»é¢è¡¨ç¤ºã‚’å¤‰ãˆã‚‹
                        document.querySelector('h3').innerText = "å®Œäº†ã—ã¾ã—ãŸ";
                        document.querySelector('p').innerText = "ã“ã®ã‚¿ãƒ–ã‚’é–‰ã˜ã¦ãã ã•ã„ã€‚";
                    }, 3000);

                }, 100);

            } else {
                document.body.innerHTML = "<div class='card'><h3>ã‚¨ãƒ©ãƒ¼</h3><p>ãƒ‘ã‚¹ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p></div>";
            }
        };
    </script>
</body>
</html>
